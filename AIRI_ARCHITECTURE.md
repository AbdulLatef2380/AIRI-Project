# AIRI Architecture Overview (The Master Blueprint)

تعتمد AIRI على معمارية متعددة الطبقات (Layered Architecture) تضمن الفصل الصارم بين المهام، مما يحقق أقصى درجات الأداء، الأمان، وقابلية التوسع.

## 1. هيكلية الطبقات (The Layers)

| الطبقة | المكونات الرئيسية | الدور الوظيفي |
| :--- | :--- | :--- |
| **الطبقة المرئية (Visual)** | `OverlayService`, `AvatarView` | تمثيل AIRI بصرياً والتعامل مع تفاعلات اللمس. |
| **الطبقة المعرفية (Cognitive)** | `LlamaNative`, `AiriPersona` | "العقل" المسؤول عن التفكير، التحليل، وصياغة الردود. |
| **طبقة السياق (Context)** | `AiriAccessibilityService`, `VoiceManager` | "الحواس" التي تسمع وترى وتفهم ما يحدث على الشاشة. |
| **طبقة الذاكرة (Memory)** | `MemoryManager`, `AiriDatabase` | "المخزن" الذي يحفظ تاريخ المحادثات والتفضيلات الشخصية. |
| **طبقة التحكم (Control)** | `SystemControlManager`, `ActionExecutor` | "اليدان" التي تنفذ الأوامر الفعلية في نظام أندرويد. |

## 2. ناقل البيانات المركزي (The Context Bus)

تعمل AIRI عبر نظام تجميع السياق، حيث يتم دمج البيانات من مصادر مختلفة قبل إرسالها للعقل المعرفي:
1. **المدخلات:** (صوت أو نص من المستخدم).
2. **السياق البصري:** (بيانات الشاشة الحالية من Accessibility Service).
3. **السياق التاريخي:** (آخر 5 تفاعلات من الذاكرة العرضية).
4. **الحالة العاطفية:** (المزاج الحالي من Emotion Engine).

يتم دمج هذه العناصر في **Prompt** واحد متكامل يضمن أن رد AIRI دقيق ومرتبط بالواقع اللحظي للمستخدم.

## 3. دورة حياة الطلب (Request Lifecycle)

عندما ينادي المستخدم "AIRI":
1. **التفعيل:** يكتشف `WakeWordEngine` النداء وينبه `OverlayService`.
2. **الاستعداد:** ينتقل `EmotionEngine` لحالة `CURIOUS` ويفتح الميكروفون.
3. **الاستيعاب:** يحول `Vosk` الصوت لنص، ويجمع `AccessibilityService` بيانات الشاشة.
4. **التفكير:** يعالج `llama.cpp` البيانات المدمجة ويصدر رداً (نص + أمر محتمل).
5. **التنفيذ:** يعرض الرد نصياً، وإذا وجد أمر، يطلب `SystemControl` الموافقة قبل التنفيذ.

## 4. التواصل بين اللغات (JNI Bridge)

يتم التواصل بين طبقة التطبيق (Kotlin) ومحرك الاستدلال (C++) عبر جسر **JNI**:
- **Kotlin:** تدير دورة حياة التطبيق، الواجهات، والأذونات.
- **C++:** تتولى العمليات الحسابية الثقيلة لنموذج LLM لضمان السرعة القصوى.

---
*هذه المعمارية تضمن أن AIRI كيان متكامل، مرن، ومستعد للتطور المستقبلي.*
